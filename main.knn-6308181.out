Using device: cuda
Grid Strategy: [4, 5, 6] (pooling votes)
Loading model: resnet50...

--- Setting up Memory Bank (Single Plants) ---
Loading data from: /scratch/ezq9qu/images_max_side_800

Splitting dataset

Found 1408033 total images belonging to 7806 classes.
Loading cached training embeddings from /scratch/ezq9qu/knn/embeddings/train_embs_resnet50.npz
Normalizing and building Index...
Found existing FAISS index at /scratch/ezq9qu/knn/faiss_index/faiss.idx
Index dimension matches. Loading...

--- Processing Grid Size: 4x4 ---
Initializing inference dataset for a 4x4 grid.
Found 2105 images, creating 33680 total tiles.
Loading cached embeddings: /scratch/ezq9qu/knn/embeddings/quadrat_embs_resnet50_4x4.npz
Running KNN...

--- Processing Grid Size: 5x5 ---
Initializing inference dataset for a 5x5 grid.
Found 2105 images, creating 52625 total tiles.
Extracting embeddings...
Running KNN...

--- Processing Grid Size: 6x6 ---
Initializing inference dataset for a 6x6 grid.
Found 2105 images, creating 75780 total tiles.
Extracting embeddings...
Running KNN...

Pooling votes from all grids...
  Processing grid pass 1/3 (33680 tiles)...
  Processing grid pass 2/3 (52625 tiles)...
  Processing grid pass 3/3 (75780 tiles)...
  Aggregating votes for 2105 unique quadrats...
Writing submission to /scratch/ezq9qu/submissions/submission_resnet50_pooled_4_5_6.csv

Done! Pooled submission saved to: /scratch/ezq9qu/submissions/submission_resnet50_pooled_4_5_6.csv
